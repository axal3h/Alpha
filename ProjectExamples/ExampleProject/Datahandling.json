// Function to handle editing student names
function editStudentName() {
  var selectedValue = $('#sel').val();
  var newName = $('#editNameInput').val(); // Assumes you have an input field with id 'editNameInput' for editing names

  // Here we should check if newName is not empty and is a valid string
  // ...

  // Find the student object in your dropdown
  var studentList = $('#sel').data('studentList');
  var student = studentList.find(student => student.value === selectedValue);
  if (student) {
    student.label = newName;
    updateStudentList(studentList);
  }
}

// Function to handle reordering of student list
// This function assumes you are using a drag and drop library that updates an array of student objects
function reorderStudentList(newOrder) {
  updateStudentList(newOrder);
}

// Function to update the student list in both the dropdown and the server
function updateStudentList(newList) {
  $('#sel').data('studentList', newList); // Update the dropdown data
  updateDropdownOptions(newList); // Re-render the dropdown options

  // Send updated list to server via POST
  $.ajax({
    url: 'PageAPI.php', // Your PHP API endpoint
    type: 'POST',
    data: { action: 'updateStudentList', studentList: newList },
    success: function(response) {
      console.log('Student list updated:', response);
    },
    error: function(xhr, status, error) {
      console.error('An error occurred:', error);
    }
  });
}

// Utility function to re-render the dropdown options based on the student list
function updateDropdownOptions(studentList) {
  var $dropdown = $('#sel');
  $dropdown.empty(); // Remove current options
  $dropdown.append($('<option>', { value: '', text: '-- Select --' })); // Add default option
  studentList.forEach(function(student) {
    $dropdown.append($('<option>', { value: student.value, text: student.label }));
  });
}

// This function should be called on page load to initialize the dropdown with data from server
function initStudentDropdown() {
  // Fetch the student list from the server
  $.getJSON('PageAPI.php', { action: 'getStudentList' }, function(data) {
    $('#sel').data('studentList', data.dropdownOptions); // Store it in the dropdown data
    updateDropdownOptions(data.dropdownOptions); // Render the options
  });
}

// Event listeners for edit and reorder buttons
$('#editButton').on('click', editStudentName); // Assumes you have a button with id 'editButton'
$('#reorderButton').on('click', function() {
  var newOrder = /* Logic to get the new order from your drag and drop functionality */;
  reorderStudentList(newOrder);
});

// Initialize the student dropdown on page load
$(document).ready(function() {
  initStudentDropdown();
});
